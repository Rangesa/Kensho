# プロジェクト "ghidra-mcp-native" の概要と評価

**作成日**: 2025年12月15日

## 1. プロジェクト概要

このプロジェクト `ghidra-mcp-native` は、Rust言語で開発された**超軽量・高速なバイナリ解析Model Context Protocol (MCP) サーバー**である。

その主な目的は、Ghidraのような高度なリバースエンジニアリング機能を、AIエージェント（Claude Codeなど）向けに最適化し、JVM（Java仮想マシン）に依存するGhidra Headlessが持つパフォーマンス上のオーバーヘッドなしに提供することにある。

特に、大規模バイナリを解析する際にAIエージェントが直面する「コンテキスト長の制限」という問題を、**階層的解析アーキテクチャ**によって解決することを目指している。

## 2. 主な特徴

- **⚡ 高速起動**: JVMが不要なため、ミリ秒単位での高速な起動を実現。
- **🪶 軽量**: 単一のネイティブバイナリとして動作し、メモリ消費量が少ない。
- **🔧 Ghidra非依存**: Ghidraの優れた設計思想（特にP-code）を継承しつつ、Rustで完全に再実装。
- **🤖 AIフレンドリー**: AIエージェントがツールとして利用しやすいMCPに準拠。階層的解析により、コンテキストオーバーフローを防止。
- **🔒 メモリセーフ**: Rustの所有権モデルにより、メモリ安全性を保証。
- **💾 高速キャッシュ**: xxHash3ベースのキャッシュシステムを搭載し、繰り返し行われる解析を劇的に高速化。

## 3. コア技術とアーキテクチャ

本プロジェクトの核心は、GhidraのデコンパイルパイプラインをRustで再現している点にある。

1.  **バイナリフォーマット解析**: `goblin`ライブラリを使用し、PE (Windows), ELF (Linux), Mach-O (macOS) といった主要なファイルフォーマットを横断的に解析する。
2.  **逆アセンブル**: `capstone`ライブラリを統合し、様々なCPUアーキテクチャの機械語をアセンブリ言語に変換する。
3.  **P-codeへの変換**: プロジェクトの最大の技術的特徴。アーキテクチャ固有のアセンブリ命令を、Ghidra由来のアーキテクチャ非依存な中間表現 **P-code** に翻訳する。これにより、後段の解析処理を共通化している。
4.  **解析コア (`decompiler_prototype`)**:
    - **CFG (制御フローグラフ)構築**: P-codeを基に、プログラムの実行パスをグラフとして表現。
    - **SSA (静的単一代入)形式変換**: データフロー解析を容易にするため、変数が一度だけ定義される形式に変換。
    - **型推論**: 演算の種類やデータの使われ方から、変数のデータ型を推論。
    - **制御構造解析**: CFGから`if/else`, `while`ループといった高レベルなプログラム構造を復元。

## 4. 実装されているツール (MCP)

AIエージェントは以下のツールを呼び出すことで、階層的に解析を進めることができる。

- `get_binary_summary`: バイナリ全体の統計情報（関数やセクションの数など）を軽量に取得。
- `list_sections`, `list_functions`, `list_strings`: 各要素をページ分割・フィルタ付きで一覧取得。
- `analyze_function_detail`: 特定の関数に絞り、逆アセンブル結果とデコンパイル結果を詳細に取得。
- `decompile_function_native`: プロジェクト独自のネイティブデコンパイラを実行。
- `decompile_function_cached`: キャッシュを利用して高速にデコンパイル。
- `decompile_with_ghidra` (オプション): 高品質な解析が必要な場合、Ghidra Headlessと連携。

## 5. 技術評価

### デコンパイル技術レベル

Ghidraの技術力を100点とした場合、このプロジェクトの**現時点でのデコンパイル技術は35点**と評価できる。

- **基盤技術 (P-code, SSA, CFG, 基本的な型推論など)**: 高いレベルで実装されており、デコンパイラの根幹はほぼ完成している。
- **応用・成熟技術 (可読性を高める無数の最適化パス、高度な型推論、多アーキテクチャ対応など)**: これらは今後の拡張領域として残されている。

この点数は、プロジェクトがまだ発展途上であることを示す一方、最も重要で困難な**基盤部分が既に完成している**ことを意味しており、ポテンシャルは非常に高い。

### 汎用性

- **対応アーキテクチャ**: 現状は**x86-64に特化**しているが、P-codeの採用により、将来的に他のアーキテクチャ(ARM等)へ拡張することが容易な設計になっている。
- **対応ファイルフォーマット**: `goblin`の採用により、**汎用性は高い**。Windows (PE), Linux (ELF), macOS (Mach-O) の主要なバイナリに標準で対応可能。

## 6. 類似プロジェクトとの比較

| プロジェクト | 特徴 | 本プロジェクトとの違い |
| :--- | :--- | :--- |
| **Rizin/Cutter** | C製の高速なREフレームワーク | デコンパイラはGhidraプラグイン等に依存。 |
| **Binary Ninja** | 独自のIL(BNIL)を持つ高品質なデコンパイラ | 商用製品。C++製。 |
| **angr** | シンボリック実行に特化したPython製フレームワーク | 自動解析が主目的。パフォーマンスより柔軟性。 |
| **Panopticon** | Rust製の実験的なデコンパイラ | より研究的で、多機能ではない。 |

このプロジェクトの独自性は、以下の3点を高レベルで兼ね備えている点にある。
1. **Rustによるパフォーマンスと安全性**
2. **Ghidra由来の堅牢な解析手法 (P-code)**
3. **AIエージェント連携という明確な目的**

## 7. 総評と将来性

`ghidra-mcp-native`は、明確なビジョンと優れたアーキテクチャ、そしてそれを実現する高い技術力が融合した、極めて質の高いプロジェクトである。

サンプルコード群は、ライブラリのAPIが開発者フレンドリーであることを示しており、実在の大規模アプリケーションを対象にしていることから、実用性への強いこだわりがうかがえる。

完成すれば、AIエージェントによる自律的な脆弱性診断やマルウェア解析といった、リバースエンジニアリングの未来を大きく前進させる画期的なツールになる可能性を秘めている。
